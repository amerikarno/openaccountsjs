<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Finansia</title>

    <!-- CSS -->
    <link href="../../assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../assets/css/jquery-ui.css" rel="stylesheet">
    <link href="../../assets/css/style.css" rel="stylesheet">
    <!-- JAVASCRIPT -->
    <script src="../../assets/js/jquery-3.4.1.min.js"></script>
    <script src="../../assets/js/jquery.form-validator-2.1.67.js"></script>
    <script src="../../assets/js/jquery-ui.js"></script>
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
    <script src="../../assets/js/ie-emulation-modes-warning.js"></script>
    <script src="../../assets/js/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>

    <link rel="stylesheet" href="../../assets/css/jquery.Thailand.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
        integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/davidshimjs-qrcodejs@0.0.2/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>
</head>

<body><div id="header">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <div class="logo">
                    <a href="#"><img src="../../assets/imgs/header/logo.png" class="img-responsive" alt=""></a>
                </div>
            </div>
        </div>
    </div>
</div><!-- CONTENT -->
<div id="idcard">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 no-padding-mobile">
                <form id="module_idcard" action="#" method="GET" class="form" role="form">
                    <!-- process -->
                    <div class="border">
                        <div class="process">
                            <div class="col-xs-12 col-md-5">
                                <div class="process__title">กรอกข้อมูลบนบัตรประชาชน</div>
                            </div>
                            <div class="col-xs-12 col-md-7">
                                <div class="process__list">
                                    <li>
                                        <svg viewBox="0 0 36 36" class="circular-chart orange">
                                            <path class="circle-bg"
                                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                            <path class="circle" stroke-dasharray="20, 100"
                                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                            <text x="18" y="23" class="percentage">1</text>
                                        </svg>
                                        <div class="title orange">กรอกข้อมูล</div>
                                    </li>
                                    <li>
                                        <div class="arrow">
                                            <svg version="1.1" viewBox="0 0 132.4 100.4">
                                                <polyline class="svg" points="78.7,96.9 125.3,50.2 78.7,3.5 " />
                                                <line class="svg" x1="125.3" y1="50.2" x2="0" y2="50.2" />
                                            </svg>
                                        </div>
                                    </li>
                                    <li>
                                        <svg viewBox="0 0 36 36" class="circular-chart ">
                                            <path class="circle-bg"
                                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                            <path class="circle" stroke-dasharray="50, 100"
                                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                            <text x="18" y="23" class="percentage">2</text>
                                        </svg>
                                        <div class="title">ยืนยันตัวตน</div>
                                    </li>
                                    <li>
                                        <div class="arrow">
                                            <svg version="1.1" viewBox="0 0 132.4 100.4">
                                                <polyline class="svg" points="78.7,96.9 125.3,50.2 78.7,3.5 " />
                                                <line class="svg" x1="125.3" y1="50.2" x2="0" y2="50.2" />
                                            </svg>
                                        </div>
                                    </li>
                                    <li>
                                        <svg viewBox="0 0 36 36" class="circular-chart ">
                                            <path class="circle-bg"
                                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                            <path class="circle" stroke-dasharray="80, 100"
                                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                            <text x="18" y="23" class="percentage">3</text>
                                        </svg>
                                        <div class="title">รับรหัสผ่าน</div>
                                    </li>
                                </div>
                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="clear"></div>
                    <!-- birth date -->
                    <div class="border z-index-3">
                        <div class="content">
                            <div class="col-xs-12 col-md-5 no-padding">
                                <div class="content__title">
                                    <span><img src="../../assets/imgs/gift.svg" alt=""> </span>
                                    <span>วัน/เดือน/ปี เกิด <span class="orange">*</span></span>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-7">
                                <div class="col-xs-4 padding">
                                    <div class="formgroup" id="colorDate">
                                        <div class="label-drop" id="labelDate">วันที่ </div>
                                        <select id="Date" name="Date" class="dropdown" data-validation="required"
                                            data-validation-error-msg="กรุณาระบุวันที่"
                                            onchange="changeColor('Date');changBorderColor('Date');">
                                            <option value="" class="label">วันที่</option>
                                        </select>
                                        <div id="errorDate"></div>
                                        <div id="errorDate2"></div>
                                    </div>
                                </div>
                                <div class="col-xs-4 padding">
                                    <div class="formgroup" id="colorMonth">
                                        <div class="label-drop" id="labelMonth">เดือน </div>
                                        <select id="Month" name="Month" class="dropdown" data-validation="required"
                                            data-validation-error-msg="กรุณาเลือกเดือน"
                                            onchange="changeColor('Month');changBorderColor('Month');">
                                            <option value="" class="label">เดือน</option>
                                            <option value="1">ม.ค.</option>
                                            <option value="2">ก.พ.</option>
                                            <option value="3">มี.ค.</option>
                                            <option value="4">เม.ย.</option>
                                            <option value="5">พ.ค.</option>
                                            <option value="6">มิ.ย.</option>
                                            <option value="7">ก.ค.</option>
                                            <option value="8">ส.ค.</option>
                                            <option value="9">ก.ย.</option>
                                            <option value="10">ต.ค.</option>
                                            <option value="11">พ.ย.</option>
                                            <option value="12">ธ.ค.</option>
                                        </select>
                                        <div id="errorMonth"></div>
                                    </div>
                                </div>
                                <div class="col-xs-4 padding">
                                    <div class="formgroup" id="colorYear">
                                        <div class="label-drop" id="labelYear">ปี (พ.ศ.) </div>
                                        <select id="Year" name="Year" class="dropdown" data-validation="required"
                                            data-validation-length="min1" data-validation-error-msg="เลือกปี (พ.ศ.)"
                                            onchange="changeColor('Year');changBorderColor('Year');">
                                            <option value="" class="label">ปี (พ.ศ.)</option>
                                        </select>
                                        <div id="errorYear"></div>
                                    </div>
                                </div>
                                <div id="birthdate_noti" class="colororange" style="float:right;"></div>
                            </div>
                        </div>
                        <div class="clear"></div>
                        <input type="hidden" id="birthdate">
                        <input type="hidden" id="daypass">
                        <input type="hidden" id="birthday" name="birthday" data-kyc="birthdate">
                    </div>
                    <!-- สถานะ -->
                    <div class="border z-index-3">
                        <div class="content">
                            <div class="col-xs-12 col-md-5 no-padding">
                                <div class="content__title">
                                    <span><img src="../../assets/imgs/person.svg" alt=""> </span>
                                    <span>สถานะ <span class="orange">*</span></span>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-7">

                                <input type="hidden" id="StatusChoiceVal" data-kyc="MaritalStatus">
                                <div class="choice status-choice">
                                    <li style="padding-right:50px;">
                                        <label for="StatusChoice1" class="radio"> โสด
                                            <input type="radio" class="StatusChoice" name="StatusChoice"
                                                id="StatusChoice1" value="single" data-validation="required"
                                                data-validation-error-msg="กรุณาเลือกสถานะ">
                                            <span class="checkround"></span>
                                        </label>
                                    </li>
                                    <li style="padding-right:50px;">
                                        <label for="StatusChoice2" class="radio"> สมรส
                                            <input type="radio" class="StatusChoice" name="StatusChoice"
                                                id="StatusChoice2" value="married" data-validation="required"
                                                data-validation-error-msg="กรุณาเลือกสถานะ">
                                            <span class="checkround"></span>
                                        </label>
                                    </li>
                                    <li style="padding-right:50px;">
                                        <label for="StatusChoice3" class="radio"> หย่า
                                            <input type="radio" class="StatusChoice" name="StatusChoice"
                                                id="StatusChoice3" value="divorce" data-validation="required"
                                                data-validation-error-msg="กรุณาเลือกสถานะ">
                                            <span class="checkround"></span>
                                        </label>
                                    </li>
                                    <div id="errorStatusChoice"></div>
                                </div>
                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <!-- id card -->
                    <div class="border z-index-1">
                        <div class="content">
                            <div class="col-xs-12 col-md-5 no-padding">
                                <div class="content__title">
                                    <span><img src="../../assets/imgs/person.svg" alt=""> </span>
                                    <span>หมายเลขบัตรประจำตัวประชาชน <span class="orange">*</span></span>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-7">
                                <div class="col-xs-12 col-md-8 padding">
                                    <div class="formgroup">
                                        <input type="text" class="id-padding" id="Idcard" name="Idcard" data-kyc="uid"
                                            data-validation="idcard" data-validation-length="min13"
                                            error-text="กรุณาระบุ หมายเลขบัตรประชาชน 13 หลัก" maxlength="13"
                                            onkeydown="keyDown(event)"
                                            oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1'); onkeyup=checkForm()"
                                            onblur="checkExistIdcard();" />
                                        <span class="highlight"></span>
                                        <span class="bar"></span>
                                        <span class="right id-padding"><img src="../../assets/imgs/check.svg" alt=""></span>
                                        <label for="Idcard" class="id-padding">ตัวเลข 13 หลัก <span>*</span></label>
                                        <div id="errorIdcard"></div>
                                    </div>
                                    <div id="idcard_noti" class="colororange id-padding id-right-float id-duplicate">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <!-- laser -->
                    <div class="border">
                        <div class="content">
                            <div class="col-xs-12 col-md-5 no-padding">
                                <div class="content__title">
                                    <span><img src="../../assets/imgs/person.svg" alt=""> </span>
                                    <span>เลขหลังบัตรประชาชน (Laser Code) <span class="orange">*</span></span>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-7 flex">
                                <div class="col-xs-12 col-md-8 padding">
                                    <div class="formgroup-laser" action="#">
                                        <div class="laser-title">ตัวอักษร 2 หลักแรก ตามด้วยตัวเลข 10 หลัก <span
                                                class="orange">*</span></div>
                                        <div class="laser">
                                            <li class="four">
                                                <input type="text" class="laser-center laserInput uppercase" id="Laser1"
                                                    name="Laser1" data-next="2" data-validation="laser"
                                                    data-validation-length="min2" maxlength="2"
                                                    data-validation-error-msg="ตัวอักษรและตัวเลขรวม 12 หลัก"
                                                    placeholder="XX" onkeydown="keyDown(event)"
                                                    oninput="this.value = this.value.replace(/[^A-Za-z.]/g, '').replace(/(\..*)\./g, '$1');" />
                                                <span class="highlight"></span>
                                                <span class="bar"></span>
                                            </li>
                                            <li> </li>
                                            <li class="one">
                                                <input type="text" class="laser-center laserInput" id="Laser2"
                                                    name="Laser2" data-next="3" data-validation="laser"
                                                    data-validation-length="min1" maxlength="1"
                                                    data-validation-error-msg="ตัวอักษรและตัวเลขรวม 12 หลัก"
                                                    placeholder="X" onkeydown="keyDown(event)"
                                                    oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');" />
                                                <span class="highlight"></span>
                                                <span class="bar"></span>
                                            </li>
                                            <li>-</li>
                                            <li>
                                                <input type="text" class="laser-center laserInput" id="Laser3"
                                                    name="Laser3" data-next="4" data-validation="laser"
                                                    data-validation-length="min7" maxlength="7"
                                                    data-validation-error-msg="ตัวอักษรและตัวเลขรวม 12 หลัก"
                                                    placeholder="XXXXXXX" onkeydown="keyDown(event)"
                                                    oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');" />
                                                <span class="highlight"></span>
                                                <span class="bar"></span>
                                            </li>
                                            <li>-</li>
                                            <li class="two">
                                                <input type="text" class="laser-center laserInput" id="Laser4"
                                                    name="Laser4" data-validation="laser" data-validation-length="min2"
                                                    maxlength="2"
                                                    data-validation-error-msg="ตัวอักษรและตัวเลขรวม 12 หลัก"
                                                    placeholder="XX" onkeydown="keyDown(event)"
                                                    oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');" />
                                                <span class="highlight"></span>
                                                <span class="bar"></span>
                                                <div id="errorLaserCode"></div>
                                            </li>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-md-4 padding">
                                    <div class="formgroup idcard-laser">
                                        <img src="../../assets/imgs/laser.jpg" class="img" alt="">
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="laser_id" name="laser_id" data-kyc="laser_id">
                            <input type="hidden" id="status_module" name="status_module" data-kyc="status_module">
                        </div>
                        <div class="clear"></div>
                    </div>
                    <!-- bottom -->
                    <input type="hidden" name="token" data-kyc="token">
                    <div class="col-xs-12 padding hidden-md hidden-lg">
                        <div class="condition"><span>*</span> ข้อมูลสำคัญ กรุณากรอกให้ครบถ้วน</div>
                    </div>
                    <div class="clear"></div>
                    <div class="bottom">
                        <div class="col-xs-6 col-md-4 padding">
                            <a onclick="btnBack()" class="arrow" role="button">
                                <svg version="1.1" viewBox="0 0 132.4 100.4">
                                    <polyline class="svg" points="78.7,96.9 125.3,50.2 78.7,3.5 " />
                                    <line class="svg" x1="125.3" y1="50.2" x2="0" y2="50.2" />
                                </svg>
                                <div>ย้อนกลับ</div>
                            </a>
                        </div>
                        <div class="col-md-4 padding hidden-xs hidden-sm">
                            <div class="condition"><span>*</span> ข้อมูลสำคัญ กรุณากรอกให้ครบถ้วน</div>
                        </div>
                        <div class="col-xs-6 col-md-4 padding no-padding-mobile"><input type="button" class="submit"
                                value="ถัดไป" onclick="btnNext()" style="background-color:#f2f2f2;"></div>
                    </div>


                </form>
            </div>
        </div>
    </div>
    <div class="clear"></div>

    <div id="existEMTerm" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content ">
                <div class="modal-header">
                </div>
                <div class="modal-body mdb-msg">
                    <p>
                        ท่านเคยกรอกข้อมูลแล้ว กรุณาคลิก ตกลง เพื่อกรอกข้อมูลเปิดบัญชีต่อ
                    </p>
                </div>
                <div class="modal-footer">
                    <button href="javascript:void(0)" onclick="hideModalexistEM()" class="button-accept" type="button"
                        aria-label="Close">ตกลง</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Have CDD -->
    <div id="BlacklistCDD" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content ">
                <div class="modal-header">
                </div>
                <div class="modal-body mdb-msg">
                    <p>
                        ไม่สามารถเปิดบัญชีได้ เนื่องจากท่านไม่ผ่านการตรวจสอบ Customer Due Diligencer (CDD)
                    </p>
                </div>
                <div class="modal-footer">
                    <button href="javascript:void(0)" onclick="hideModalBlacklistCDD()" class="button-accept"
                        type="button" aria-label="Close">ตกลง</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DOPA modal -->
    <div id="dopaModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content ">
                <div class="modal-header">
                </div>
                <div class="modal-body mdb-msg">
                    <p>ไม่สามารถเปิดบัญชีได้ ท่านไม่ผ่านการตรวจสอบ DOPA เนื่องจาก <span id="dopaModalMessage"></span>
                    </p>
                </div>
                <div class="modal-footer">
                    <button href="javascript:void(0)" onclick="hideDopaModal()" class="button-accept" type="button"
                        aria-label="Close">ตกลง</button>
                </div>
            </div>
        </div>
    </div>

    <!-- modal -->
    <div id="ErrorModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content ">
                <div class="modal-header">
                </div>
                <div class="modal-body mdb-msg">
                    <p><span id="modalErrorMessage"></span>
                    </p>
                </div>
                <div class="modal-footer">
                    <button href="javascript:void(0)" onclick="hideErrorModal()" class="button-accept" type="button"
                        aria-label="Close">ตกลง</button>
                </div>
            </div>
        </div>
    </div>

</div>

<div id="waiting_modal_dialog" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">

            <div class="modal-body mdb-msg" style="text-align:center;">
                <p>
                    ระบบกำลังอยู่ระหว่างดำเนินการกรุณารอสักครู่
                </p>
                <img src="../../assets/imgs/wait.gif">
            </div>

        </div>
    </div>
</div>

<div id="footer">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-md-6">
                <div class="info">
                    <div class="info__text">สอบถามข้อมูลเพิ่มเติม 
                        <!-- ทุกวันทำการ 8:30 - 18:00 น. -->
                    </div>
                    <div class="info__call">
                        <div class="call"><a href="tel:020884666"><img src="../../assets/imgs/footer/tel.svg" alt="">
                                <span>02 088 4666</span></a></div>
                        <div class="email"><a href="mailto:cxcenter@fnsyrus.com"><img
                                    src="../../assets/imgs/footer/email.svg" alt=""><span> callcenter@finansiada.com</span></a></div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-md-6">
                <div class="copy">สงวนลิขสิทธิ์ บริษัท ฟินันเซีย ดิจิทัล แอสเซท จำกัด</div>
            </div>
        </div>
    </div>
    <div class="clear"></div>
</div><script src="../../assets/js/framework.js"></script>
<script src="../../assets/js/script.js"></script>
<script>
    let module = 'loadIDcard';
    // let module = 'module_idcard';

    let load_idcard, load_laser1, load_laser2, load_laser3, load_laser4 = "";
    $(window).on("load", function (e) {
        let v = parseInt('1');

        if (v !== 1) {
            $('#waiting_modal_dialog').addClass('show');
            setTimeout(() => {
                window.location.href = '/send-reload-page';
            }, 1000);
        }

        initCurrenPage(module)

        var year = new Date().getFullYear() + 543;
        for (i = (year - 20); i > (year - 101); i--) {
            $('#Year').append(
                $('<option></option>').val(i).html(i)
            );
        }

        var days = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
            24, 25,
            26, 27, 28, 29, 30, 31
        ];
        for (i = 1; i <= days.length; i++) {
            $('#Date').append(
                $('<option></option>').val(i).html(i)
            );
        }

        customLoad(module, function (data) {
            console.log(data)
            let session = 'N';

            if (data.birthdate !== "" && data.birthdate !== null) {
                let birthdate = data.birthdate;
                let birthdateArr = birthdate.split("-");
                let year = typeof birthdateArr[0] !== "undefined" ? parseInt(birthdateArr[0]) + 543 :
                    "00"
                selectDate(birthdateArr[2]);
                selectMonth(birthdateArr[1]);
                selectYear(year);

                $("#labelDate").fadeIn()
                $("#labelMonth").fadeIn()
                $("#labelYear").fadeIn()

                $("#Date-button").addClass(
                    "ui-selectmenu-button ui-selectmenu-button-closed ui-corner-all ui-button ui-widget ui-selectmenu-disabled ui-state-disabled input"
                );
                $("#Month-button").addClass(
                    "ui-selectmenu-button ui-selectmenu-button-closed ui-corner-all ui-button ui-widget ui-selectmenu-disabled ui-state-disabled input"
                );
                $("#Year-button").addClass(
                    "ui-selectmenu-button ui-selectmenu-button-closed ui-corner-all ui-button ui-widget ui-selectmenu-disabled ui-state-disabled input"
                );

                $('#Date').prop("disabled", true);
                $('#Month').prop("disabled", true);
                $('#Year').prop("disabled", true);
            }

            if (data.MaritalStatus == "single") {
                $("#StatusChoice1").prop("checked", true);
            }
            else if (data.MaritalStatus == "married") {
                $("#StatusChoice2").prop("checked", true);
            }
            else if (data.MaritalStatus == "divorce") {
                $("#StatusChoice3").prop("checked", true);
            }

            if (data.laser_id !== "" && data.laser_id !== null) {
                let laser_id = data.laser_id;
                load_laser1 = laser_id.substring(0, 2);
                load_laser2 = laser_id.substring(2, 3);
                load_laser3 = laser_id.substring(3, 10);
                load_laser4 = laser_id.substring(10, 12);
            }


            if (session == "Y") {
                if (data.uid !== "" && data.uid !== null) {
                    load_idcard = data.uid;
                    $('#Idcard').val(data.uid).addClass('ui-state-disabled input valid').prop("disabled",
                        true);
                }

                $('#Laser1').val(load_laser1).addClass('ui-state-disabled input valid').prop("disabled",
                    true);
                $('#Laser2').val(load_laser2).addClass('ui-state-disabled input valid').prop("disabled",
                    true);
                $('#Laser3').val(load_laser3).addClass('ui-state-disabled input valid').prop("disabled",
                    true);
                $('#Laser4').val(load_laser4).addClass('ui-state-disabled input valid').prop("disabled",
                    true);
            } else {
                if (data.uid !== "" && data.uid !== null) {
                    load_idcard = data.uid;
                    $('#Idcard').val(data.uid).addClass('input valid');
                }
            }
        });

    });

    function initCurrenPage(module) {
        const wsurl = `${MAIN_URL}/api/currentPage`;
        var data = {
            module: module
        };
        fetch(wsurl, {
            method: "POST",
            body: JSON.stringify(data)
        })
            .then(response => response.text())
            .then(function (result) { })
            .catch(error => console.log('error', error));
    }

    function checkSession(module) {
        let token = 'Y';
        let session = 'N';

        if (session == "Y") {
            const wsurl = `${MAIN_URL}/api/currentPage`;
            var data = {
                module: module
            };
            fetch(wsurl, {
                method: "POST",
                body: JSON.stringify(data)
            })
                .then(response => response.text())
                .then(function (result) {
                    let data = JSON.parse(result)
                    if (data.success == false) {
                        window.location.href = '/register';
                    }
                })
                .catch(error => console.log('error', error));
        }
    }

    $('.StatusChoice').on('change', function () {
        if (typeof $('.StatusChoice:checked')[0] !== 'undefined') {
            $("#errorStatusChoice").addClass("hidden")
        } else {
            $("#errorStatusChoice").removeClass("hidden")
        }
    })

    $('.laserInput').keyup(function (e) {
        if (this.value.length === this.maxLength) {
            let next = $(this).data('next');
            $('#Laser' + next).focus();
        }
    });

    $("select").selectmenu({
        change: function (event, data) {
            changeColor(this.name);
            changBorderColor(this.name);

        }
    });

    function selectDate(val) {
        $('#Date').val(val);
        $('#Date').selectmenu("refresh");
    }

    function selectMonth(val) {
        $('#Month').val(val);
        $('#Month').selectmenu("refresh");
    }

    function selectYear(val) {
        $('#Year').val(val);
        $('#Year').selectmenu("refresh");
    }

    function checkID(id) {
        if (id.length != 13)
            return false;
        for (i = 0, sum = 0; i < 12; i++) {
            sum += parseFloat(id.charAt(i)) * (13 - i);
        }
        if ((11 - sum % 11) % 10 != parseFloat(id.charAt(12))) {
            return false;
        }
        return true;
    }

    function checkDayPassed() {
        var year = $('#Year').val();
        var month = $('#Month').val();
        var day = $('#Date').val();
        var daypassed = true;
        var year_feb = (year - 543) % 4;

        if (month == 1 || month == 3 || month == 5 || month == 7 || month == 8 || month == 10 ||
            month == 12) {
            if (day >= 1 && day <= 31) {
                daypassed = true;
            } else {
                daypassed = false;
            }
        } else if (month == 4 || month == 6 || month == 9 || month == 11) {
            if (day >= 1 && day <= 30) {
                daypassed = true;
            } else {
                daypassed = false;
            }
        } else if (month == 2) {
            if (year_feb == 0) {
                if (day >= 1 && day <= 29) {
                    daypassed = true;
                } else {
                    daypassed = false;
                }
            } else {
                if (day >= 1 && day <= 28) {
                    daypassed = true;
                } else {
                    daypassed = false;
                }
            }

        }

        var birthday = year + "/" + month + "/" + day;
        var dateOfBirth = new Date(birthday);
        var ageDifMs = Date.now() - dateOfBirth.getTime();
        var ageDate = new Date(ageDifMs);
        var result = 0
        var yearNum = parseInt(year)
        var era = yearNum < 2463 ? "AD" : "BE";

        if (era == "BE") {
            result = 543 - Math.abs(ageDate.getUTCFullYear() - 1970)
        } else {
            result = Math.abs(ageDate.getUTCFullYear() - 1970)
        }

        $('#birthdate').val(result);
        $('#daypass').val(daypassed);

        $("#birthdate_noti").html("");

        $("#errorDate2").html("");

        let obj = {
            day: day,
            month: month,
            year: year,
            daypassed: daypassed,
            result: result
        }

        return obj;
    }

    function notiDayPassed(daypassed, result) {
        if (daypassed) {
            if (result < 20) {
                document.getElementById("Year").removeAttribute("datanoti");
                document.getElementById("Year").setAttribute("datanoti", "not_20");
                $("#errorDate").html("");
                $("#errorMonth").html("");
                $("#errorYear").html("");
                $("#birthdate_noti").html(
                    `<div class="help-block form-error" style="padding-left:20px; padding-right:20px;">ท่านไม่สามารถสมัครขอเปิดบัญชีได้ เนื่องจากอายุไม่ถึงเกณฑ์ 20 ปีบริบูรณ์</div>`
                );
                const element = document.getElementById("colorDate");
                element.scrollIntoView();
            } else {
                $("#birthdate_noti").html("");
            }
        }
    }

    function invalidDay() {
        document.getElementById("Date").removeAttribute("datanoti");
        document.getElementById("Date").setAttribute("datanoti", "day_wrong");
        $("#Date").attr({
            "current-error": "กรุณาเลือกวันที่",
            "border-color": "red"
        }).addClass("error");
        $("#errorDate").html("");
        $("#errorDate2").html(
            `<div class="help-block form-error">กรุณาเลือกวันที่</div>`
        )

        $("#Date-button").attr("style", "border-color: red;");
        const element = document.getElementById("colorDate");
        element.scrollIntoView();
    }

    $("#Date-menu").click(function () {
        let data = checkDayPassed();

        notiDayPassed(data.daypassed, data.result);

        if (!data.daypassed && data.month != "") {
            invalidDay()
        } else {
            $("#Date-button").removeAttr("style").attr("style", "border-bottom:2px solid #002561;");
        }
    });

    $("#Month-menu").click(function () {
        let data = checkDayPassed();

        notiDayPassed(data.daypassed, data.result);

        if (!data.daypassed && data.day != "") {
            invalidDay()
        }
        else if (data.day != "") {
            $("#Date-button").removeAttr("style").attr("style", "border-bottom:2px solid #002561;");
        }
        else {
            $("#Date-button").removeAttr("style").attr("style", "border-bottom:2px solid #002561;");
        }
    });

    $("#Year-menu").click(function () {
        let data = checkDayPassed();

        notiDayPassed(data.daypassed, data.result);

        if (!data.daypassed && data.day != "" && data.month != "") {
            invalidDay()
        }
        else {
            $("#Date-button").removeAttr("style").attr("style", "border-bottom:2px solid #002561;");
        }
    });

    function changBorderColor(type) {
        if (type == "Date") {
            $("#Date-button").removeAttr("style").attr("style", "border-bottom:2px solid #002561;");
        } else if (type == "Month") {
            $("#Month-button").removeAttr("style").attr("style", "border-bottom:2px solid #002561;");
        } else if (type == "Year") {
            $("#Year-button").removeAttr("style").attr("style", "border-bottom:2px solid #002561;");
        }
    }

    let idcardExistCheck = false;

    function checkExistIdcard() {
        const wsurl = `${MAIN_URL}/api/checkExistIdcard`;
        var data = {
            idcard: document.getElementById("Idcard").value
        };

        fetch(wsurl, {
            method: "POST",
            body: JSON.stringify(data)
        })
            .then(response => response.text())
            .then(function (result) {
                let data = JSON.parse(result);
                console.log(data)

                if (data.success == false) {
                    $("#errorIdcard").html(
                        `<div class="help-block form-error">เลขบัตรประชาชนนี้ถูกใช้ลงทะเบียนไปแล้ว</div>`);

                    idcardExistCheck = true;
                    $("#existEMTerm").addClass('show');
                }
            })

    }

    function btnNext() {
        checkSession(module)

        var formData = $('#module_idcard').serializeArray().reduce(function (obj, item) {
            obj[item.name] = item.value;
            return obj;
        }, {});

        let dopa_status = true;
        let next_page = true;
        let dopa_noti = document.getElementById('dopa_noti');
        let dateCheck = formData.Date;
        let monthCheck = formData.Month;
        let yearCheck = formData.Year;
        let daypassCheck = document.getElementById("daypass").value;
        let idcardCheck = typeof formData.Idcard != "undefined" ? formData.Idcard : load_idcard;
        let Laser1Check = typeof formData.Laser1 != "undefined" ? formData.Laser1 : load_laser1;
        let Laser2Check = typeof formData.Laser2 != "undefined" ? formData.Laser2 : load_laser2;
        let Laser3Check = typeof formData.Laser3 != "undefined" ? formData.Laser3 : load_laser3;
        let Laser4Check = typeof formData.Laser4 != "undefined" ? formData.Laser4 : load_laser4;
        if (StatusChoice1.checked) {
            $("#StatusChoiceVal").val(StatusChoice1.value);
        }
        else if (StatusChoice2.checked) {
            $("#StatusChoiceVal").val(StatusChoice2.value);
        }
        else if (StatusChoice3.checked) {
            $("#StatusChoiceVal").val(StatusChoice3.value);
        }

        formData.Idcard = idcardCheck;
        formData.Laser1 = Laser1Check.toUpperCase();
        formData.Laser2 = Laser2Check;
        formData.Laser3 = Laser3Check;
        formData.Laser4 = Laser4Check;

        $("#laser_id").val(formData.Laser1 + formData.Laser2 + formData.Laser3 + formData.Laser4);

        if (Laser1Check == "") {
            next_page = false;
            $("#Laser1").attr("style", "border-color: red;");
            const element = document.getElementById("errorLaserCode");
            element.scrollIntoView();
        }
        if (Laser2Check == "") {
            next_page = false;
            $("#Laser2").attr("style", "border-color: red;");
            const element = document.getElementById("errorLaserCode");
            element.scrollIntoView();
        }
        if (Laser3Check == "") {
            next_page = false;
            $("#Laser3").attr("style", "border-color: red;");
            const element = document.getElementById("errorLaserCode");
            element.scrollIntoView();
        }
        if (Laser4Check == "") {
            next_page = false;
            $("#errorLaserCode").html(`<div class="help-block form-error">ตัวอักษรและตัวเลขรวม 12 หลัก</div>`);
            $("#Laser4").attr("style", "border-color: red;");
            const element = document.getElementById("errorLaserCode");
            element.scrollIntoView();
        }
        if (idcardCheck.length != 13) {
            next_page = false;
            for (i = 0, sum = 0; i < 12; i++) {
                sum += parseFloat(idcardCheck.charAt(i)) * (13 - i);
            }
            if ((11 - sum % 11) % 10 != parseFloat(idcardCheck.charAt(12))) {
                next_page = false;
                $("#errorIdcard").html(`<div class="help-block form-error">ตัวเลข 13 หลักไม่ถูกต้อง</div>`);
                const element = document.getElementById("errorIdcard");
                element.scrollIntoView();
            }
            next_page = false;
        } else if (idcardCheck.length == 13) {
            for (i = 0, sum = 0; i < 12; i++) {
                sum += parseFloat(idcardCheck.charAt(i)) * (13 - i);
            }
            if ((11 - sum % 11) % 10 != parseFloat(idcardCheck.charAt(12))) {
                next_page = false;
                $("#errorIdcard").html(`<div class="help-block form-error">ตัวเลข 13 หลักไม่ถูกต้อง</div>`);
                const element = document.getElementById("errorIdcard");
                element.scrollIntoView();
            }
        }
        if (idcardCheck == "") {
            next_page = false;
            $("#errorIdcard").html(`<div class="help-block form-error">กรุณาระบุ หมายเลขบัตรประชาชน 13 หลัก</div>`);
            $("#Idcard").attr("style", "border-color: red;");
            const element = document.getElementById("errorIdcard");
            element.scrollIntoView();
        }
        if (!StatusChoice1.checked && !StatusChoice2.checked && !StatusChoice3.checked) {
            next_page = false;
            $("#errorStatusChoice").html(`<div class="help-block form-error"">กรุณาเลือกสถานะ</div>`);
            const element = document.getElementById("StatusChoice1");
            element.scrollIntoView();
        }
        if (dateCheck == "") {
            next_page = false;
            $("#errorDate").html(`<div class="help-block form-error">กรุณาเลือกวันที่</div>`);
            $("#Date-button").attr("style", "border-color: red;");
            const element = document.getElementById("colorDate");
            element.scrollIntoView();
        }
        if (monthCheck == "") {
            next_page = false;
            $("#errorMonth").html(`<div class="help-block form-error">กรุณาเลือกเดือน</div>`);
            $("#Month-button").attr("style", "border-color: red;");
            const element = document.getElementById("colorMonth");
            element.scrollIntoView();
        }
        if (yearCheck == "") {
            next_page = false;
            $("#errorYear").html(`<div class="help-block form-error">กรุณาเลือกปี (พ.ศ.)</div>`);
            $("#Year-button").attr("style", "border-color: red;");
            const element = document.getElementById("colorYear");
            element.scrollIntoView();
        }

        var year = $('#Year').val();
        var month = $('#Month').val();
        var day = $('#Date').val();
        var daypassed = true;
        var year_feb = (year - 543) % 4;

        let year2 = parseInt(year) - 543;

        let birthday2 = "";
        birthday2 = year2 + "-" + month + "-" + day;
        $("#birthday").val(birthday2);

        if ($('#birthdate') != "") {

            var birthday = year + "/" + month + "/" + day;
            var dateOfBirth = new Date(birthday);
            var ageDifMs = Date.now() - dateOfBirth.getTime();
            var ageDate = new Date(ageDifMs);
            var result = 0
            var yearNum = parseInt(year)
            var era = yearNum < 2463 ? "AD" : "BE";

            if (era == "BE") {
                result = 543 - Math.abs(ageDate.getUTCFullYear() - 1970)
            } else {
                result = Math.abs(ageDate.getUTCFullYear() - 1970)
            }

            $('#birthdate').val(result);

            notiDayPassed(daypassed, result);

            if (!daypassed && day != "" && month != "")
                invalidDay()

            if (!daypassed && day != "")
                invalidDay()

            if (!daypassed && month != "") {
                invalidDay()
            }
        }
        let birthdateCheck = document.getElementById("birthdate").value;

        if (birthdateCheck < 20)
            next_page = false;
        if (daypassCheck == "false")
            next_page = false;
        if (idcardExistCheck == true) {
            next_page = false;
            const element = document.getElementById("errorIdcard");
            element.scrollIntoView();
        }

        if (dateCheck != "" && monthCheck != "" && yearCheck != "" && idcardCheck.length == 13 && Laser1Check.length ==
            2 && Laser2Check.length == 1 && Laser3Check.length == 7 && Laser4Check.length == 2) {
            if (next_page == true) {
                $("#status_module").val("next_module");
                $('#waiting_modal_dialog').addClass('show');

                setTimeout(() => {
                    const wsurl = `${MAIN_URL}/api/clearViewCount`;
                    var data = {
                        url: ""
                    };
                    fetch(wsurl, {
                        method: "POST",
                        body: JSON.stringify(data)
                    })
                        .then(response => response.text())
                        .then(function (result) {
                            customInput(module).save(null, (res) => {
                                console.log("======>", res)
                                checkUserStatus();
                            });
                        })
                        .catch(error => console.log('error', error));
                }, 1000);
            }
        }
    };

    function checkUserStatus() {
        var forCDD;
        var dopaStatus;
        setTimeout(() => {
            message = localStorage.getItem("message");
            dopaStatus = localStorage.getItem("message");
            forNModule = localStorage.getItem("nModule");

            var res = message.split(":")

            var code = res[0];
            var desc = res[1]

            if (code != "0") {
                if (Number(code) < 7) {
                    showModaldopa(desc)
                } else if (message == "FREEZE" || message == "FREEZE-04" || message == "FREEZE-05" || message == "LED") {
                    BlacklistCDD();
                }
                else if (forNModule != null) {
                    window.location = `${window.location.origin}/${forNModule}`;
                } else if (message == "Invalid date") {
                    const element = document.getElementById("colorDate");
                    element.scrollIntoView();
                    $("#errorDate2").html(
                        `<div class="help-block form-error">วันที่ไม่ถูกต้อง</div>`
                    )
                    $("#Date-button").attr("style", "border-color: red;");
                    $('#waiting_modal_dialog').removeClass('show');
                } else {
                    showModalError("<div style='text-align: center;'>ขณะนี้ระบบไม่สามารถดำเนินการได้ กรุณาทำรายการใหม่อีกครั้ง หรือติดต่อเจ้าหน้าที่ Call center </br> หมายเลขโทรศัพท์ 02 088 4666  </br> email : callcenter@finansiada.com</div>")
                }
            } else if (forNModule != null) {
                window.location = `${window.location.origin}/${forNModule}`;
            }

        }, 2500);
    }

    function BlacklistCDD() {
        $("#BlacklistCDD").addClass('show');
        $('#waiting_modal_dialog').removeClass('show');
        localStorage.removeItem("message");
    }

    function btnBack() {
        checkSession(module)

        $("#status_module").val("back_module");
        $('#waiting_modal_dialog').addClass('show');
        setTimeout(() => {
            const wsurl = `${MAIN_URL}/api/clear-view-count`;
            var data = {
                url: "/register/form/preinfo"
            };
            fetch(wsurl, {
                method: "POST",
                body: JSON.stringify(data)
            })
                .then(response => response.text())
                .then(function (result) {
                    customInput(module).save();
                })
                .catch(error => console.log('error', error));
        }, 1000);
    }

    function checkForm() {
        if (!checkID($("#Idcard").val()))
            $('.right').fadeOut()
        else
            $('.right').fadeIn()
    }

    function hideModalexistEM() {
        $('.modal').removeClass('show');
        setTimeout(() => {
            window.open(`${MAIN_URL}/go-edit-op-acc`, "_self");
        }, 500);
    }

    function hideModalBlacklistCDD() {
        $('.modal').removeClass('show');
    }

    function showModaldopa(dopaText) {
        $("#dopaModalMessage").text(dopaText)
        $("#dopaModal").addClass('show');
        $('#waiting_modal_dialog').removeClass('show');
    }


    function hideDopaModal() {
        $('#dopaModal').removeClass('show');
    }

    function showModalError(texterror) {
        $("#modalErrorMessage").html(texterror)
        $("#ErrorModal").addClass('show');
        $('#waiting_modal_dialog').removeClass('show');
    }


    function hideErrorModal() {
        $('#ErrorModal').removeClass('show');
    }

</script>
</body>

</html>